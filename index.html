<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIS SYSTEM CLOUD - PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, updateDoc, getDocs, deleteDoc, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZdCAoXdP0QfKJdnxBWzZ5vo4trhzsa74",
            authDomain: "ausmass-plaene.firebaseapp.com",
            projectId: "ausmass-plaene",
            storageBucket: "ausmass-plaene.firebasestorage.app",
            messagingSenderId: "270413900259",
            appId: "1:270413900259:web:642158e2858a9ad28058d6"
        };

        const appId = "ausmass-plaene-app";
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let allProjects = []; 
        const CHUNK_SIZE = 500000; 

        async function initAuth() {
            try {
                await setPersistence(auth, browserLocalPersistence);
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    try { await signInWithCustomToken(auth, __initial_auth_token); } 
                    catch (e) { await signInAnonymously(auth); }
                } else {
                    await signInAnonymously(auth);
                }
            } catch (e) {
                showStatus("AUTH ERROR", "error");
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                setupProjectsListener();
            } else {
                initAuth();
            }
        });

        function showStatus(msg, type = "success") {
            const status = document.getElementById('status-msg');
            if (!status) return;
            status.innerText = msg;
            const colors = { success: 'bg-blue-600', error: 'bg-red-600', info: 'bg-orange-500' };
            status.className = `fixed bottom-6 left-1/2 -translate-x-1/2 px-8 py-4 rounded-2xl text-white font-bold shadow-2xl z-[300] transition-all duration-300 uppercase italic text-[10px] tracking-widest ${colors[type] || colors.success}`;
            status.style.opacity = "1";
            setTimeout(() => { if(status) status.style.opacity = "0"; }, 3000);
        }

        // --- FORMULAR LOGIK ---

        function getFormData() {
            return {
                auftragsart: document.querySelector('input[name="art"]:checked')?.value || '',
                verantwortlicher: document.getElementById('verantwortlicher').value,
                projekt_id: document.getElementById('projekt_id').value.trim(),
                adresse: document.getElementById('adresse').value,
                datum: document.getElementById('datum').value,
                pl_intern: document.getElementById('pl_intern').value,
                zeichner: document.getElementById('zeichner').value,
                kunde: document.getElementById('kunde').value,
                pl_extern: document.getElementById('pl_extern').value,
                tel_bauleitung: document.getElementById('tel_bauleitung').value,
                tel_monteur: document.getElementById('tel_monteur').value,
                mr_status: document.querySelector('input[name="mr"]:checked')?.value || '',
                etagen: Array.from(document.querySelectorAll('.etage-cb:checked')).map(cb => cb.value),
                kunde_anvisiert: document.getElementById('kunde_anvisiert').checked,
                polier_informiert: document.getElementById('polier_informiert').checked,
                interne_infos: document.getElementById('interne_infos').value,
                baustellen_protokoll: document.getElementById('baustellen_protokoll').value,
                lastUpdated: new Date().toISOString()
            };
        }

        function resetForm() {
            // Sicherheitsabfrage
            if(!confirm("M√∂chten Sie ein neues Formular starten? Alle aktuellen Eingaben und die PDF-Liste werden geleert.")) return;
            
            // 1. Alle Textfelder, Datum und Textareas leeren
            const inputs = document.querySelectorAll('input[type="text"], input[type="datetime-local"], textarea');
            inputs.forEach(i => i.value = '');
            
            // 2. Alle Radio-Buttons und Checkboxen abw√§hlen
            const checkables = document.querySelectorAll('input[type="radio"], input[type="checkbox"]');
            checkables.forEach(c => c.checked = false);
            
            // 3. Etagen-Styling zur√ºcksetzen (da diese √ºber CSS-Klassen gesteuert werden)
            document.querySelectorAll('.etage-cb').forEach(cb => {
                cb.checked = false;
                updateEtageStyle(cb);
            });
            
            // 4. PDF-Liste im UI leeren
            const fileList = document.getElementById('file-list');
            if(fileList) {
                fileList.innerHTML = '<p class="text-slate-700 text-[11px] font-black uppercase italic text-center py-20 opacity-30">KEINE DATEIEN VERKN√úPFT</p>';
            }
            
            // 5. Zur√ºck nach oben scrollen
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            showStatus("FORMULAR BEREINIGT - NEUES OBJEKT BEREIT");
        }

        // --- PROJEKT CRUD ---

        async function saveToCloud() {
            if(!currentUser) return;
            const data = getFormData();
            if(!data.projekt_id) { showStatus("ID FEHLT!", "error"); return; }
            
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'projekte', data.projekt_id);
                const snap = await getDoc(docRef);
                if(snap.exists()) {
                    data.files = snap.data().files || [];
                }

                await setDoc(docRef, data, { merge: true });
                showStatus("PROJEKT GESPEICHERT");
            } catch(e) { showStatus("SPEICHERFEHLER", "error"); }
        }

        async function deleteProject(id) {
            if(!confirm(`Projekt "${id}" wirklich l√∂schen?`)) return;
            showStatus("L√ñSCHEN...", "info");
            try {
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'projekte', id, 'fileData');
                const qSnap = await getDocs(colRef);
                const deletePromises = [];
                qSnap.forEach(d => deletePromises.push(deleteDoc(d.ref)));
                await Promise.all(deletePromises);
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projekte', id));
                showStatus("PROJEKT ENTFERNT");
            } catch(e) { showStatus("L√ñSCHFEHLER", "error"); }
        }

        // --- ARCHIV ---

        function setupProjectsListener() {
            const q = collection(db, 'artifacts', appId, 'public', 'data', 'projekte');
            onSnapshot(q, (snap) => {
                allProjects = [];
                snap.forEach(d => allProjects.push({ id: d.id, ...d.data() }));
                renderArchiv();
            }, (err) => console.error(err));
        }

        function renderArchiv(filterText = "") {
            const list = document.getElementById('archiv-liste');
            if(!list) return;
            list.innerHTML = '';
            const filtered = allProjects.filter(p => p.id.toLowerCase().includes(filterText.toLowerCase()) || (p.kunde || "").toLowerCase().includes(filterText.toLowerCase()));
            filtered.forEach(p => {
                const tr = document.createElement('tr');
                tr.className = "border-b border-slate-100 hover:bg-slate-50 transition-colors cursor-pointer";
                tr.onclick = () => loadProjectData(p.id);
                tr.innerHTML = `
                    <td class="p-4"><div class="flex flex-col"><span class="font-black text-slate-900 text-xs uppercase italic">${p.id}</span><span class="text-[8px] text-slate-400 font-bold uppercase tracking-widest">${p.kunde || 'KEIN KUNDE'}</span></div></td>
                    <td class="p-4"><span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[8px] font-black uppercase tracking-tighter italic">${p.verantwortlicher || 'N/A'}</span></td>
                    <td class="p-4"><span class="text-[9px] font-bold text-slate-500">${p.lastUpdated ? new Date(p.lastUpdated).toLocaleDateString() : '-'}</span></td>
                    <td class="p-4 text-right space-x-2">
                        <button class="bg-blue-600 text-white px-3 py-2 rounded-lg text-[9px] font-black uppercase italic shadow-sm">√ñFFNEN</button>
                        <button onclick="event.stopPropagation(); deleteProject('${p.id}')" class="bg-red-50 text-red-400 p-2 rounded-lg text-[9px]">üóëÔ∏è</button>
                    </td>
                `;
                list.appendChild(tr);
            });
        }

        // --- FILE HANDLING ---

        async function uploadFile(event) {
            const file = event.target.files[0];
            const projId = document.getElementById('projekt_id').value.trim();
            if(!projId) { showStatus("ZUERST PROJEKT-ID EINTRAGEN!", "error"); event.target.value = ''; return; }
            if(!file || file.type !== "application/pdf") { showStatus("NUR PDF!", "error"); return; }

            showStatus("UPLOAD STARTET...", "info");
            const currentData = getFormData();
            
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const base64 = reader.result;
                const fileId = crypto.randomUUID();
                try {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'projekte', projId);
                    const snap = await getDoc(docRef);
                    const currentFiles = snap.exists() ? (snap.data().files || []) : [];
                    
                    const updatedData = { ...currentData, files: [...currentFiles, { id: fileId, name: file.name, size: file.size, timestamp: new Date().toISOString() }] };
                    await setDoc(docRef, updatedData, { merge: true });

                    for (let i = 0, j = 0; i < base64.length; i += CHUNK_SIZE, j++) {
                        await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projekte', projId, 'fileData', `${fileId}_${j}`), { data: base64.substring(i, i + CHUNK_SIZE), fileId, index: j });
                    }
                    showStatus("PLAN GESPEICHERT");
                    loadProjectData(projId);
                } catch(e) { showStatus("UPLOAD FEHLER", "error"); }
                event.target.value = '';
            };
        }

        async function loadProjectData(id) {
            try {
                const snap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'projekte', id));
                if(snap.exists()) {
                    const d = snap.data();
                    document.getElementById('projekt_id').value = id;
                    document.getElementById('adresse').value = d.adresse || '';
                    document.getElementById('datum').value = d.datum || '';
                    document.getElementById('pl_intern').value = d.pl_intern || '';
                    document.getElementById('zeichner').value = d.zeichner || '';
                    document.getElementById('kunde').value = d.kunde || '';
                    document.getElementById('pl_extern').value = d.pl_extern || '';
                    document.getElementById('tel_bauleitung').value = d.tel_bauleitung || '';
                    document.getElementById('tel_monteur').value = d.tel_monteur || '';
                    document.getElementById('verantwortlicher').value = d.verantwortlicher || '';
                    document.getElementById('interne_infos').value = d.interne_infos || '';
                    document.getElementById('baustellen_protokoll').value = d.baustellen_protokoll || '';
                    
                    // Radio Buttons Art
                    document.querySelectorAll('input[name="art"]').forEach(rb => {
                        rb.checked = (rb.value === d.auftragsart);
                    });

                    // Radio Buttons Meterriss
                    document.querySelectorAll('input[name="mr"]').forEach(rb => {
                        rb.checked = (rb.value === d.mr_status);
                    });
                    
                    // Etagen
                    document.querySelectorAll('.etage-cb').forEach(cb => {
                        cb.checked = (d.etagen || []).includes(cb.value);
                        updateEtageStyle(cb);
                    });

                    document.getElementById('kunde_anvisiert').checked = d.kunde_anvisiert || false;
                    document.getElementById('polier_informiert').checked = d.polier_informiert || false;

                    renderFileList(d.files || [], id);
                    closeArchiv();
                    showStatus("PROJEKT GELADEN");
                }
            } catch (e) { showStatus("LADEFEHLER", "error"); }
        }

        function renderFileList(files, projId) {
            const list = document.getElementById('file-list');
            if(!list) return;
            list.innerHTML = '';
            if(!files || files.length === 0) {
                list.innerHTML = '<p class="text-slate-700 text-[11px] font-black uppercase italic text-center py-20 opacity-30">KEINE DATEIEN VERKN√úPFT</p>';
                return;
            }
            files.forEach(f => {
                const div = document.createElement('div');
                div.className = "flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/10 mb-2 hover:bg-white/10 transition-colors";
                div.innerHTML = `
                    <div class="flex items-center gap-3 cursor-pointer overflow-hidden flex-1" onclick="downloadFile('${f.id}', '${f.name}', '${projId}')">
                        <span class="text-lg">üìÑ</span>
                        <div class="flex flex-col overflow-hidden">
                            <span class="text-[9px] font-black uppercase text-white truncate">${f.name}</span>
                            <span class="text-[7px] text-blue-400 font-bold uppercase tracking-widest">${(f.size/1024/1024).toFixed(2)} MB</span>
                        </div>
                    </div>
                    <button onclick="deleteSingleFile('${f.id}', '${projId}')" class="ml-4 p-2 text-red-400 hover:text-red-600">üóëÔ∏è</button>
                `;
                list.appendChild(div);
            });
        }

        async function deleteSingleFile(fileId, projId) {
            if(!confirm("Datei aus Cloud entfernen?")) return;
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'projekte', projId);
                const snap = await getDoc(docRef);
                const updatedFiles = (snap.data().files || []).filter(f => f.id !== fileId);
                await updateDoc(docRef, { files: updatedFiles });
                showStatus("DATEI GEL√ñSCHT");
                loadProjectData(projId);
            } catch(e) { showStatus("FEHLER", "error"); }
        }

        async function downloadFile(fileId, fileName, projId) {
            showStatus("LADE DATEI...", "info");
            try {
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'projekte', projId, 'fileData');
                const snap = await getDocs(colRef);
                const chunks = [];
                snap.forEach(d => { if(d.data().fileId === fileId) chunks.push(d.data()); });
                chunks.sort((a,b) => a.index - b.index);
                const a = document.createElement('a');
                a.href = chunks.map(c => c.data).join(''); a.download = fileName;
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
                showStatus("DOWNLOAD BEREIT");
            } catch(e) { showStatus("DOWNLOAD FEHLER", "error"); }
        }

        function updateEtageStyle(cb) {
            const label = cb.closest('.etage-label');
            if(!label) return;
            if(cb.checked) {
                label.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                label.classList.remove('bg-white', 'text-slate-900', 'border-slate-200');
            } else {
                label.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                label.classList.add('bg-white', 'text-slate-900', 'border-slate-200');
            }
        }

        // Global machen
        window.saveToCloud = saveToCloud;
        window.deleteProject = deleteProject;
        window.uploadFile = uploadFile;
        window.downloadFile = downloadFile;
        window.deleteSingleFile = deleteSingleFile;
        window.updateEtageStyle = updateEtageStyle;
        window.loadProjectData = loadProjectData;
        window.renderArchiv = renderArchiv;
        window.resetForm = resetForm;
        window.openArchiv = () => { document.getElementById('archiv-modal').classList.remove('hidden'); renderArchiv(); };
        window.closeArchiv = () => document.getElementById('archiv-modal').classList.add('hidden');

    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; color: #0f172a; }
        .input-line { @apply border-b border-slate-200 outline-none focus:border-blue-600 py-1 transition-colors bg-transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @media print { .no-print { display: none !important; } .print-area { box-shadow: none !important; margin: 0; border: none !important; } }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="status-msg" class="fixed opacity-0 pointer-events-none transition-all duration-300"></div>

    <div id="archiv-modal" class="fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[200] hidden flex items-center justify-center p-4 no-print">
        <div class="bg-white w-full max-w-4xl rounded-[2.5rem] shadow-2xl overflow-hidden">
            <div class="p-8 bg-slate-900 text-white flex justify-between items-center">
                <div><h3 class="font-black uppercase italic text-blue-400 text-xl">PROJEKT MANAGER</h3></div>
                <button onclick="closeArchiv()" class="bg-white/10 w-12 h-12 rounded-full text-2xl font-black">&times;</button>
            </div>
            <div class="p-6 border-b border-slate-100 bg-slate-50">
                <input type="text" oninput="renderArchiv(this.value)" placeholder="SUCHEN..." class="w-full bg-white border border-slate-200 rounded-2xl py-4 px-6 text-xs font-black uppercase italic outline-none">
            </div>
            <div class="overflow-x-auto max-h-[60vh] custom-scrollbar">
                <table class="w-full text-left">
                    <thead class="sticky top-0 bg-white shadow-sm"><tr class="text-[9px] font-black uppercase text-slate-400 border-b"><th class="p-4 pl-8">Projekt</th><th class="p-4">Zust√§ndig</th><th class="p-4">Datum</th><th class="p-4 text-right">Aktion</th></tr></thead>
                    <tbody id="archiv-liste"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="max-w-5xl mx-auto space-y-8">
        
        <header class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4 no-print">
            <div>
                <h1 class="text-3xl font-black italic uppercase tracking-tighter text-blue-900 leading-none">GIS <span class="text-blue-500">CLOUD</span></h1>
            </div>
            <div class="flex flex-wrap gap-3">
                <button onclick="resetForm()" class="bg-orange-500 text-white px-6 py-4 rounded-2xl shadow-xl text-[10px] font-black uppercase italic hover:bg-orange-600 transition-all">
                    üÜï NEUES OBJEKT
                </button>
                <button onclick="openArchiv()" class="bg-slate-900 text-white px-8 py-4 rounded-2xl shadow-xl text-[10px] font-black uppercase italic hover:bg-blue-600 transition-all flex items-center gap-3">
                    üìÇ ARCHIV
                </button>
            </div>
        </header>

        <div class="bg-white rounded-[3rem] shadow-2xl border border-slate-100 overflow-hidden print-area">
            <div class="grid grid-cols-1 md:grid-cols-12 border-b border-slate-50">
                <div class="md:col-span-8 p-10 border-r border-slate-50">
                    <span class="text-[9px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4 block italic">AUFTRAGS-STATUS</span>
                    <div class="flex flex-wrap gap-8">
                        <label class="flex items-center gap-3 cursor-pointer group"><input type="radio" name="art" value="Ausmessen" class="w-6 h-6 accent-blue-600"><span class="text-sm font-black uppercase text-slate-700 italic">Ausmessen</span></label>
                        <label class="flex items-center gap-3 cursor-pointer group"><input type="radio" name="art" value="Service" class="w-6 h-6 accent-blue-600"><span class="text-sm font-black uppercase text-slate-700 italic">Service</span></label>
                    </div>
                </div>
                <div class="md:col-span-4 p-10 bg-blue-50/40">
                    <span class="text-[9px] font-black text-blue-500 uppercase tracking-[0.2em] mb-2 block italic">VERANTWORTLICHER</span>
                    <input type="text" id="verantwortlicher" class="w-full bg-transparent border-b-2 border-blue-100 outline-none focus:border-blue-600 py-1 font-black text-blue-900 uppercase text-base italic" placeholder="NAME">
                </div>
            </div>

            <div class="p-10 space-y-16">
                <section>
                    <div class="flex items-center gap-4 mb-10">
                        <div class="w-12 h-12 bg-blue-900 rounded-2xl flex items-center justify-center text-white font-black italic shadow-lg">01</div>
                        <h2 class="text-xl font-black uppercase italic tracking-tighter">PROJEKTSTAMM</h2>
                    </div>
                    <div class="space-y-10">
                        <div class="bg-slate-50 p-8 rounded-[2.5rem] border border-slate-100 shadow-inner">
                            <label class="text-[8px] font-black text-slate-400 uppercase tracking-widest block mb-2 italic">OBJEKTBEZEICHNUNG / CLOUD-ID (PFLICHTFELD)</label>
                            <input type="text" id="projekt_id" class="w-full bg-transparent border-none outline-none font-black text-2xl text-slate-900 uppercase italic placeholder:text-slate-200" placeholder="Z.B. PROJEKT-M√úLLER-2024">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-8">
                            <div class="space-y-8">
                                <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Adresse / Einsatzort</label><input type="text" id="adresse" class="input-line text-sm font-bold uppercase italic"></div>
                                <div class="grid grid-cols-2 gap-6">
                                    <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">PL Intern</label><input type="text" id="pl_intern" class="input-line text-sm font-bold uppercase italic"></div>
                                    <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Zeichner</label><input type="text" id="zeichner" class="input-line text-sm font-bold uppercase italic"></div>
                                </div>
                            </div>
                            <div class="space-y-8">
                                <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Datum</label><input type="datetime-local" id="datum" class="input-line text-sm font-bold"></div>
                                <div class="grid grid-cols-2 gap-6">
                                    <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Kunde</label><input type="text" id="kunde" class="input-line text-sm font-bold uppercase italic"></div>
                                    <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">PL Extern</label><input type="text" id="pl_extern" class="input-line text-sm font-bold uppercase italic"></div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-8">
                            <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Tel. Bauleitung</label><input type="text" id="tel_bauleitung" class="input-line text-sm font-bold uppercase italic"></div>
                            <div class="flex flex-col"><label class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Tel. Monteur</label><input type="text" id="tel_monteur" class="input-line text-sm font-bold uppercase italic"></div>
                        </div>
                    </div>
                </section>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 border-t border-slate-50 pt-16">
                    <section>
                        <div class="flex items-center gap-4 mb-8"><div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white font-black text-sm italic">02</div><h2 class="text-base font-black uppercase italic tracking-tighter">METERRISS</h2></div>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between p-5 border border-slate-200 rounded-[1.5rem] cursor-pointer hover:bg-blue-50 transition shadow-sm group"><span class="text-[10px] font-black uppercase italic">MR PLAQUETTE</span><input type="radio" name="mr" value="MR Plaquette" class="w-6 h-6 accent-blue-600"></label>
                            <label class="flex items-center justify-between p-5 border border-slate-200 rounded-[1.5rem] cursor-pointer hover:bg-blue-50 transition shadow-sm group"><span class="text-[10px] font-black uppercase italic">MR BLEISTIFT</span><input type="radio" name="mr" value="MR Bleistift" class="w-6 h-6 accent-blue-600"></label>
                            <label class="flex items-center justify-between p-5 border border-red-100 bg-red-50/20 rounded-[1.5rem] cursor-pointer hover:bg-red-50 transition shadow-sm group"><span class="text-[10px] font-black uppercase italic text-red-600">KEIN METERRISS</span><input type="radio" name="mr" value="Kein Meterriss" class="w-6 h-6 accent-red-600"></label>
                        </div>
                    </section>
                    <section>
                        <div class="flex items-center gap-4 mb-8"><div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white font-black text-sm italic">03</div><h2 class="text-base font-black uppercase italic tracking-tighter">ETAGEN</h2></div>
                        <div class="grid grid-cols-4 gap-3 mb-8 italic">
                            <script>
                                const etagen = ["UG", "EG", "1.OG", "2.OG", "3.OG", "4.OG", "5.OG", "6.OG", "7.OG", "8.OG", "9.OG", "10.OG"];
                                etagen.forEach(e => {
                                    document.write(`<label class="etage-label border border-slate-200 rounded-2xl py-4 text-center cursor-pointer text-[10px] font-black transition-all hover:border-blue-300"><input type="checkbox" value="${e}" class="hidden etage-cb" onchange="updateEtageStyle(this)"> ${e}</label>`);
                                });
                            </script>
                        </div>
                        <div class="space-y-4 px-2">
                            <label class="flex items-center gap-4 text-xs font-black text-slate-700 cursor-pointer uppercase italic"><input type="checkbox" id="kunde_anvisiert" class="w-5 h-5 rounded-lg accent-blue-900"> Kunde anvisiert</label>
                            <label class="flex items-center gap-4 text-xs font-black text-slate-700 cursor-pointer uppercase italic"><input type="checkbox" id="polier_informiert" class="w-5 h-5 rounded-lg accent-blue-900"> Polier informiert</label>
                        </div>
                    </section>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 border-t border-slate-50 pt-16">
                    <div class="bg-blue-900 text-white p-10 rounded-[3rem] space-y-6">
                        <h3 class="text-xs font-black uppercase italic text-blue-300">B√úRO INFOS</h3>
                        <textarea id="interne_infos" rows="5" class="w-full bg-white/5 border-none outline-none text-sm font-bold p-6 rounded-[2rem] placeholder:text-blue-700 italic uppercase"></textarea>
                    </div>
                    <div class="bg-slate-800 text-white p-10 rounded-[3rem] space-y-6">
                        <h3 class="text-xs font-black uppercase italic text-slate-400">BAUSTELLEN-PROTOKOLL</h3>
                        <textarea id="baustellen_protokoll" rows="5" class="w-full bg-white/5 border-none outline-none text-sm font-bold p-6 rounded-[2rem] placeholder:text-slate-600 italic uppercase"></textarea>
                    </div>
                </div>

                <section class="no-print pt-10 border-t border-slate-50">
                    <div class="bg-slate-900 rounded-[3.5rem] p-12 shadow-2xl relative">
                        <div class="relative z-10 grid grid-cols-1 lg:grid-cols-5 gap-12 items-start">
                            <div class="lg:col-span-2 space-y-6">
                                <h3 class="text-blue-400 font-black italic uppercase text-3xl">PLAN CLOUD</h3>
                                <div class="relative mt-8">
                                    <input type="file" id="pdf_upload" onchange="uploadFile(event)" accept="application/pdf" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                                    <div class="border-2 border-dashed border-slate-700 rounded-[2.5rem] p-12 text-center bg-white/5 border-blue-500/30">
                                        <span class="text-5xl block mb-4">üì§</span>
                                        <span class="text-[11px] font-black text-white uppercase italic">DATEI HOCHLADEN</span>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-3">
                                <div id="file-list" class="space-y-4 max-h-80 overflow-y-auto custom-scrollbar pr-4">
                                    <p class="text-slate-700 text-[11px] font-black uppercase italic text-center py-20 opacity-30">KEINE DATEIEN VERKN√úPFT</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <footer class="flex flex-col md:flex-row gap-6 no-print pb-20">
            <button onclick="saveToCloud()" class="flex-[3] bg-blue-600 text-white font-black py-8 rounded-[2rem] shadow-2xl hover:bg-blue-700 active:scale-[0.98] transition-all uppercase tracking-[0.4em] text-base italic flex items-center justify-center gap-6 group">
                <span class="text-2xl group-hover:scale-150 transition-transform">üíæ</span> IN CLOUD SPEICHERN
            </button>
            <button onclick="window.print()" class="flex-1 bg-white border-2 border-slate-200 text-slate-800 px-10 font-black rounded-[2rem] hover:bg-slate-50 transition-all uppercase text-xs tracking-widest italic flex items-center justify-center gap-3">
                üñ®Ô∏è DRUCKEN / PDF
            </button>
        </footer>
    </div>
</body>
</html>